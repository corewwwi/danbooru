<div id="c-comments">
  <div id="a-index">
    <h1>Comments</h1>

    <%= render "posts/partials/common/inline_blacklist" %>

    <% if !CurrentUser.user.is_builder? %>
      <div style="margin-bottom: 1em;">
        <h2>Before commenting, read the <%= link_to "how to comment guide", wiki_pages_path(:search => {:title => "howto:comment"}) %>.</h2>
      </div>
    <% end %>

    <% if @posts.select(&:visible?).empty? %>
      <%= render "post_sets/blank" %>
    <% end %>

    <% @posts.select(&:visible?).each do |post| %>
      <% if post.comments.any?(&:visible?) %>
        <div id="post_<%= post.id %>" class="post <%= PostPresenter.preview_class(post) %>" <%= PostPresenter.data_attributes(post) %>>
          <div class="preview">
            <%= link_to(image_tag(post.preview_file_url), post_path(post)) %>
          </div>
          <%= render "comments/partials/index/list", :post => post, :comments => post.comments.recent.above_threshold(CurrentUser.user).select(&:visible?).reverse, :show_header => true %>
          <div class="clearfix"></div>
        </div>
      <% end %>
    <% end %>

    <%= numbered_paginator(@posts) %>
  </div>
</div>

<%= render "comments/secondary_links" %>

<% content_for(:page_title) do %>
  Comments - <%= Danbooru.config.app_name %>
<% end %>
